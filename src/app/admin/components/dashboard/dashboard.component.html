<div class="header">
    <div class="navbar">
        <div class="logo">
            <img src="public/bg-nav-300.png" alt="logo">
        </div>
        <div class="nav">
            <button id="navButton">
                <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px"
                    fill="#000000">
                    <path
                        d="M247.85-260.62q51-36.69 108.23-58.03Q413.31-340 480-340t123.92 21.35q57.23 21.34 108.23 58.03 39.62-41 63.73-96.84Q800-413.31 800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 66.69 24.12 122.54 24.11 55.84 63.73 96.84ZM480.02-460q-50.56 0-85.29-34.71Q360-529.42 360-579.98q0-50.56 34.71-85.29Q429.42-700 479.98-700q50.56 0 85.29 34.71Q600-630.58 600-580.02q0 50.56-34.71 85.29Q530.58-460 480.02-460ZM480-120q-75.31 0-141-28.04t-114.31-76.65Q176.08-273.31 148.04-339 120-404.69 120-480t28.04-141q28.04-65.69 76.65-114.31 48.62-48.61 114.31-76.65Q404.69-840 480-840t141 28.04q65.69 28.04 114.31 76.65 48.61 48.62 76.65 114.31Q840-555.31 840-480t-28.04 141q-28.04 65.69-76.65 114.31-48.62 48.61-114.31 76.65Q555.31-120 480-120Zm0-40q55.31 0 108.85-19.35 53.53-19.34 92.53-52.96-39-31.31-90.23-49.5Q539.92-300 480-300q-59.92 0-111.54 17.81-51.61 17.81-89.84 49.88 39 33.62 92.53 52.96Q424.69-160 480-160Zm0-340q33.69 0 56.85-23.15Q560-546.31 560-580t-23.15-56.85Q513.69-660 480-660t-56.85 23.15Q400-613.69 400-580t23.15 56.85Q446.31-500 480-500Zm0-80Zm0 350Z" />
                </svg>
            </button>
            <div id="dropdownMenu" class="dropdown-content">
                <a href="#">Link 1</a>
                <a href="#">Link 2</a>
                <a href="#">Link 3</a>
            </div>
        </div>
    </div>
</div>

<div class="body">
    <h1>Admin Dashboard</h1>

    <!-- dashboard.component.html -->
    <div class="table-container">
        <!-- Loading and Error States -->
        <div *ngIf="isLoading" class="loading-state">
            <div class="spinner"></div>
            <p>Loading dashboard data...</p>
        </div>

        <div *ngIf="error" class="error-state">
            <p>{{ error }}</p>
            <button (click)="fetchDashboardData()">Retry</button>
        </div>

        <!-- Dashboard Content -->
        <div *ngIf="!isLoading && !error" class="dashboard-content">
            <!-- Navigation Tabs -->
            <nav class="dashboard-nav">
                <button *ngFor="let tab of ['overview', 'trends', 'locations']" [class.active]="activeTab === tab"
                    (click)="switchTab(tab)">
                    {{ tab | titlecase }}
                </button>
            </nav>

            <!-- Overview Section -->
            <section *ngIf="activeTab === 'overview'" class="dashboard-section">
                <div class="chart-grid">
                    <div class="chart-card">
                        <h3>Transport Types</h3>
                        <canvas id="transportType"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Popular Routes</h3>
                        <canvas id="popularRoutes"></canvas>
                    </div>
                </div>
            </section>

            <!-- Trends Section -->
            <section *ngIf="activeTab === 'trends'" class="dashboard-section">
                <div class="chart-card full-width">
                    <h3>Usage Trends</h3>
                    <canvas id="routeUsageTrends"></canvas>
                </div>
            </section>

            <!-- Locations Section -->
            <section *ngIf="activeTab === 'locations'" class="dashboard-section">
                <div class="chart-grid">
                    <div class="chart-card">
                        <h3>Popular Origins</h3>
                        <canvas id="originChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>Popular Destinations</h3>
                        <canvas id="destinationChart"></canvas>
                    </div>
                </div>
            </section>
        </div>
    </div>


    <div class="table-container">
        <h2>Route Management</h2>
        <table>
            <thead>
                <tr>
                    <th>Route ID</th>
                    <th>Route Name</th>
                    <th>Description</th>
                    <th>Color</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>J1</td>
                    <td>Jeepney Route 1 Green</td>
                    <td>Bayanihan Terminal - Mt. Pinatubo Comm.</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #228B22"></div>
                            Green
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>J2</td>
                    <td>Jeepney Route 2 Beige</td>
                    <td>Bayanihan Terminal - Clark Hostel</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #D4B895"></div>
                            Beige
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>J3</td>
                    <td>Jeepney Route 3 Blue</td>
                    <td>Bayanihan Terminal - Picnic Ground</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #1d58c6"></div>
                            Blue
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>J5</td>
                    <td>Jeepney Route 5 Red</td>
                    <td>Bayanihan Terminal - IE-5 - GGLC</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #CE0000"></div>
                            Red
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>J6</td>
                    <td>Jeepney Route 6 Yellow</td>
                    <td>Mabalacat Public Market Terminal - Philexcel</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #FFDE21"></div>
                            Yellow
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>B1</td>
                    <td>Clark Loop Northbound</td>
                    <td>Northbound</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #1d58c6"></div>
                            Blue
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>B2</td>
                    <td>Clark Loop Southbound</td>
                    <td>Southbound</td>
                    <td>
                        <div class="color-cell">
                            <div class="color-preview" style="background-color: #F98100"></div>
                            Orange
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table-container">
        <h2>Account Management</h2>
        <table>
            <thead>
                <tr>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Admin</th>
                    <th>User</th>
                    <th>Created</th>
                    <th>Updated</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let user of users">
                    <td>{{ user.first_name }}</td>
                    <td>{{ user.last_name }}</td>
                    <td>{{ user.email }}</td>
                    <td><input type="checkbox" [(ngModel)]="user.isAdmin" disabled></td>
                    <td><input type="checkbox" [(ngModel)]="user.isUser" disabled></td>
                    <td>{{ user.created_at | date: 'shortDate' }}</td>
                    <td>{{ user.updated_at | date: 'shortDate' }}</td>
                    <td>
                        <button class="btn btn-edit" (click)="editUser(user)">Edit</button>
                        <button class="btn btn-delete" (click)="user.id && deleteUser(user.id)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div *ngIf="selectedUser" class="modal">
        <div class="modal-content">
            <h2>Edit User</h2>
            <form (ngSubmit)="saveUser()">
                <div class="form-group">
                    <label for="firstName">First Name</label>
                    <input id="firstName" type="text" [(ngModel)]="selectedUser.first_name" name="first_name" required>
                </div>

                <div class="form-group">
                    <label for="lastName">Last Name</label>
                    <input id="lastName" type="text" [(ngModel)]="selectedUser.last_name" name="last_name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input id="email" type="email" [(ngModel)]="selectedUser.email" name="email" required>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input id="isAdmin" type="checkbox" [(ngModel)]="selectedUser.isAdmin" name="isAdmin"
                            (change)="toggleUserRole('isAdmin')">
                        <label for="isAdmin">Administrator Access</label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input id="isUser" type="checkbox" [(ngModel)]="selectedUser.isUser" name="isUser"
                            (change)="toggleUserRole('isUser')">
                        <label for="isUser">Standard User Access</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input id="password" type="password" [(ngModel)]="selectedUser.password" name="password">
                </div>

                <div class="form-group">
                    <label for="passwordConfirmation">Confirm Password</label>
                    <input id="passwordConfirmation" type="password" [(ngModel)]="selectedUser.passwordConfirmation"
                        name="passwordConfirmation">
                </div>

                <div class="button-group">
                    <button type="button" class="btn btn-cancel" (click)="selectedUser = null">Cancel</button>
                    <button type="submit" class="btn btn-save">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>